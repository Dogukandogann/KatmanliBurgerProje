

@model BasketListViewModel
@{
	Layout = null;
	int count = 0;
	decimal basketTotalPrice = 0;
	decimal basketTotalPriceWithTax = 0;
	decimal tax = 0;
	ICollection<BasketLine> liste = Model.Basket.BasketLines;
}

<!DOCTYPE html>
<html>

@await Component.InvokeAsync("_UILayoutHeadComponentPartial")

<body class="sub_page">

	@await Component.InvokeAsync("_MenuNavbarComponentPartial")
	<br />
	<br />
	<div class="container-fluid">
		<div class="row px-xl-5">
			<div class="col-12">
				<nav class="breadcrumb bg-dark mb-30">
					<a class="breadcrumb-item text-white" href="/Default/Index">Ana Sayfa</a>
					<a class="breadcrumb-item text-white" href="/Menu/Index">Menü</a>
					<span class="breadcrumb-item active">Sepetiniz</span>
				</nav>
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row px-xl-5">
			<div class="col-lg-8 table-responsive mb-5">
				<table class="table table-light table-borderless table-hover text-center mb-0">
					<thead class="thead-dark">
						<tr>
							<th>#</th>
							<th>Ürün Adı</th>
							<th>Adet</th>
							<th>Fiyat</th>
							<th>Toplam</th>
							<th>Sil</th>
						</tr>
					</thead>
					<tbody class="align-middle">
						@{
							basketTotalPrice = Model.Basket.BasketLines.Sum(item =>
							(item.Burger?.Price ?? 0) * item.BurgerQuantity +
							(item.Menu?.Price ?? 0) * item.MenuQuantity +
							(item.ByProduct?.Price ?? 0) * item.ByProductQuantity);

							tax = basketTotalPrice / 100 * 10;
							basketTotalPriceWithTax = basketTotalPrice + tax;
						}
						@foreach (var item in Model.Basket.BasketLines)
						{
							if (item.Burger is not null)
							{
								count++;

								<tr>
									<td class="align-middle">@count</td>
									<td class="align-middle">@item.Burger.Name</td>
									<td class="align-middle">@item.BurgerQuantity</td>
									<td class="align-middle">@item.Burger.Price</td>
									<td class="align-middle">@(item.Burger.Price * item.BurgerQuantity)</td>
									<td class="align-middle btn-delete"><a class="btn btn-sm btn-danger" href="/Baskets/RemoveFromBasket/@item.Burger.Id"><i class="fa fa-times"></i></a></td>
								</tr>
							}
							if (item.Menu is not null)
							{
								count++;

								<tr>
									<td class="align-middle">@count</td>
									<td class="align-middle">@item.Menu.Name</td>
									<td class="align-middle">@item.MenuQuantity</td>
									<td class="align-middle">@item.Menu.Price</td>
									<td class="align-middle">@(item.Menu.Price * item.MenuQuantity)</td>
									<td class="align-middle btn-delete"><a class="btn btn-sm btn-danger" asp-action="RemoveFromBasket" asp-route-menuId="@item.Menu.Id"><i class="fa fa-times"></i></a></td>
								</tr>
							}
							if (item.ByProduct is not null)
							{
								count++;

								<tr>
									<td class="align-middle">@count</td>
									<td class="align-middle">@item.ByProduct.Name</td>
									<td class="align-middle">@item.ByProductQuantity</td>
									<td class="align-middle">@item.ByProduct.Price</td>
									<td class="align-middle">@(item.ByProduct.Price * item.ByProductQuantity)</td>
									<td class="align-middle btn-delete"><a class="btn btn-sm btn-danger" href="/Baskets/RemoveFromBasket/@item.ByProduct.Id"><i class="fa fa-times"></i></a></td>
								</tr>
							}
						}
					</tbody>

				</table>
			</div>
			<div class="col-log-4">
				<form>
					<div class="input-group">
						<input type="text" id="couponcode" class="form-control border-1 p-4" placeholder="Kupon Kodunuz" />
						<div>
							<a style="height:48px;padding-top:11px; margin-left:5px;" class="btn btn-warning" id="btncouponcode">Kuponu Uygula</a>
						</div>
					</div>
				</form>
				<br />
				<h5 class="section-title position-relative  mb-3"><span class="bg-warning pr-3">Sepet Özeti</span></h5>
				<div class="bg-light p-30 mb-5">
					<div id="container" class="border-bottom pb-2">
						<div class="d-flex justify-content-between mb-6">
							<h6>Toplam Tutar</h6>
							<h6><span id="totalprice">@basketTotalPrice</span>₺</h6>
						</div>
						<div class="d-flex justify-content-between">
							<h6 class="font-weight-medium">Kdv Oranı</h6>
							<h6 id="kdv" class="font-weight-medium">@tax</>₺</h6>
						</div>
						<br />
					</div>
					<div class="pt-2">
						<div class="d-flex justify-content-between mt-2">
							<h5>Toplam Tutar</h5>
							<h5><span id="totalpricewithkdv">@basketTotalPriceWithTax</span>₺</h5>
						</div>
						<br />
						<a id="btnchecked" class="btn btn-block btn-warning font-weight-bold my-3" asp-controller="Baskets" asp-action="AddToOrder">Siparişi Tamamla</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	@await Component.InvokeAsync("_UILayoutFooterComponentPartial")

	@await Component.InvokeAsync("_UILayoutScriptComponentPartial")

</body>

</html>

@*<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

	$('#btnchecked').click(function () {

		var basketData = @liste;

		$.ajax({
			type: 'POST',
			url: 'Baskets/AddToBasket',
			data: basketData,
			dataType:"Json",
			success: function (data) {
				alert("Güncelleme Başarılı");
			},
			error: function (error) {
				alert("Hata");
			}
		});
	});

</script>*@
